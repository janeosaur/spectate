<script src="//maps.google.com/maps/api/js?key=AIzaSyBHLett8djBo62dDXj0EjCimF8Rd6E8cxg"> </script> <!-- this is general use API key from geoquakes -->
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script>

<div class="container event-index">
  <div class="row mapped">
    <div class="col-sm-2 col-sm-offset-1 search">
      <%= search_form_for @q do |f| %>
          <%= f.label "Search" %><br/>
          <%= f.search_field :name_or_organizer_or_venue_or_city_or_country_cont %>
          <%= f.label "Event Type" %>
          <%= f.select :event_type, ['minor', 'big', 'major'], include_hidden: false, include_blank: true %>
          <%= f.label "Stadium" %>
          <%= f.check_box :stadium_true, include_hidden: false %><br />
          <%= f.label "Food & Drinks Sold" %>
          <%= f.check_box :food_drinks_true, include_hidden: false %><br />
          <%= f.label "VIP Tickets" %>
          <%= f.check_box :vip_tickets_true, include_hidden: false %><br />
          <%= f.label "Merch Sold" %>
          <%= f.check_box :merch_sold_true, include_hidden: false %><br />
          <%= f.label "Alcohol Sold" %>
          <%= f.check_box :alcohol_true, include_hidden: false %><br />
          <%= f.submit %>
      <% end %>
    </div>

    <div class="col-sm-8">
      <div id="map" style='width: 700px; height: 400px;'></div>
    </div>

  </div>

  <div class="row">
    <div class="col-sm-6 sort">
      <!-- sorts ransack search results by name -->
      Sory by: <%= sort_link(@q, :date) %> |
      <%= sort_link(@q, :name) %>
    </div>
  </div>

  <div class="row">
    <% @events.each do |event| %>
      <div class="col-sm-4">
        <%= render partial: 'events/search_card', locals: { event: event} %>
      </div>
    <% end %>
  </div>


  <br/>
  <br/>

</div>

<script type="text/javascript">
  handler = Gmaps.build('Google');
  handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });
</script>



<!-- for future search integration -->
<% if false %>
  <%= f.label "Happening on: " %>
  <%= f.date_select :date_cont, include_hidden: false, include_blank: true %>
  <%= f.label "Prize money at least" %>
  <%= f.text_field :prize, include_hidden: false %>
  <%= f.label "Minimum age" %>
  <%= f.text_field :min_age, include_hidden: false %>
  <%= f.label "Price range?" %>
  <%= f.text_field :price, include_hidden: false %>

<% end %>
